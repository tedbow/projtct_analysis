image: drupalci/static_analysis:9.4.x

stages:
  - analyze

prepare-job:
  stage: analyze
  script:
    - rm -rf /var/lib/drupalci/workspace/infrastructure/stats/project_analysis/*
    - cp -R ./* /var/lib/drupalci/workspace/infrastructure/stats/project_analysis/

    - wget https://www.drupal.org/files/project_analysis/projects.tsv?$CI_JOB_ID -O /var/lib/drupalci/workspace/projects.tsv
    - cp /var/lib/drupalci/workspace/infrastructure/stats/project_analysis_utils/tests/project_list_files/projects_d10.tsv /var/lib/drupalci/workspace/projects.tsv
    - /var/lib/drupalci/workspace/infrastructure/stats/project_analysis/project_readiness.sh 9.4.x || true
    - ls -la /var/lib/drupalci/workspace/
    - ls -la /var/lib/drupalci/workspace/phpstan-results/
  artifacts:
    paths:
      - /var/lib/drupalci/workspace/phpstan-results/
      - /var/lib/drupalci/workspace/projects.tsv
      - /var/lib/drupalci/workspace/analyzer_output.log

